<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jemima’s Asking</title>

    <link rel="stylesheet" href="./styles.css" />
    <link rel="icon" href="./favicon.ico" />

    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js"
      }
    }
    </script>
  </head>
  <body>
    <div id="app"></div>

    <p
      id="emuBanner"
      hidden
      style="display:flex;align-items:center;justify-content:center;position:fixed;left:0;bottom:0;width:100%;margin:0;padding:4px 0;font-size:.9em;background:rgba(255,255,255,.9);border-top:1px solid #e0e0e0;z-index:1000;"
    >
      Running in emulator mode. Do not use with production credentials.
    </p>

    <script type="module">
      const applyConfig = (candidate) => {
        if (!candidate || typeof candidate !== "object") return false;
        window.__FIREBASE_CONFIG__ = candidate;
        return true;
      };

      async function loadHostingConfig() {
        const ctl = new AbortController();
        const timeout = setTimeout(() => ctl.abort(), 1500);
        try {
          const res = await fetch("./__/firebase/init.json", { cache: "no-store", signal: ctl.signal });
          if (!res.ok) return false;
          const json = await res.json();
          return applyConfig(json);
        } catch (_) {
          return false;
        } finally {
          clearTimeout(timeout);
        }
      }

  // Try to fetch Hosting config; don't block if missing (local Python server etc.)
  async function injectFirebaseConfig() {
    const ctl = new AbortController();
    const timeout = setTimeout(() => ctl.abort(), 1500);
    try {
      const res = await fetch("./__/firebase/init.json", { cache: "no-store", signal: ctl.signal });
      if (res.ok) {
        const json = await res.json();
        if (json && typeof json === "object") window.__FIREBASE_CONFIG__ = json;
      }

  await injectFirebaseConfig();
  await import("./src/main.js");   // <— exactly one import; do NOT duplicate
</script>
  </body>
</html>
