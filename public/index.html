<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jemimaâ€™s Asking</title>

    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="/favicon.ico" />
  </head>
  <body>
    <div id="app"></div>

    <!-- Emulator banner (only shows on localhost or ?emu=1) -->
    <p id="emuBanner" style="
      display:none; position:fixed; left:0; bottom:0; width:100%;
      margin:0; padding:4px 0; text-align:center; font-size:.9em;
      background:rgba(255,255,255,.9); border-top:1px solid #e0e0e0; z-index:1000;">
      Running in emulator mode. Do not use with production credentials.
    </p>

    <!-- Firebase ESM import map (served by Firebase Hosting) -->
    <script type="importmap">
    {
      "imports": {
        "firebase/app": "/__/firebase/12.4.0/firebase-app.js",
        "firebase/auth": "/__/firebase/12.4.0/firebase-auth.js",
        "firebase/firestore": "/__/firebase/12.4.0/firebase-firestore.js"
      }
    }
    </script>

    <!-- Bootstrap: fetch Hosting config, set env flags, then load the app once -->
    <script type="module">
      // Show emulator banner only on localhost or when ?emu=1
      const qs = new URLSearchParams(location.search);
      const isLocal = ["localhost", "127.0.0.1"].includes(location.hostname) || qs.get("emu") === "1";
      if (isLocal) document.getElementById("emuBanner").style.display = "block";

      // Fetch Firebase Hosting's init.json (optional but handy)
      async function injectFirebaseConfig() {
        try {
          const res = await fetch("/__/firebase/init.json", { cache: "no-store" });
          if (res.ok) {
            const json = await res.json();
            if (json && typeof json === "object") {
              window.__FIREBASE_CONFIG__ = json; // available to your firebase.js if you want it
            }
          }
        } catch (e) {
          console.warn("[firebase] init.json not available, proceeding with hard-coded config", e);
        }
      }

      await injectFirebaseConfig();

      // Load your app exactly once
      await import("/src/main.js");
    </script>
  </body>
</html>
