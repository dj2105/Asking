<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jemimaâ€™s Asking</title>

    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="/favicon.ico" />
  </head>
  <body>
    <div id="app"></div>

    <!-- Emulator banner (only shows on localhost or ?emu=1) -->
    <p id="emuBanner" style="
      display:none; position:fixed; left:0; bottom:0; width:100%;
      margin:0; padding:4px 0; text-align:center; font-size:.9em;
      background:rgba(255,255,255,.9); border-top:1px solid #e0e0e0; z-index:1000;">
      Running in emulator mode. Do not use with production credentials.
    </p>

    <!-- Bootstrap: fetch Hosting config, set env flags, then load the app once -->
    <script>
      (async () => {
        // Show emulator banner only on localhost or when ?emu=1
        const qs = new URLSearchParams(location.search);
        const isLocal = ["localhost", "127.0.0.1"].includes(location.hostname) || qs.get("emu") === "1";
        if (isLocal) document.getElementById("emuBanner").style.display = "block";

        const FIREBASE_SDK_VERSION = "12.4.0";
        const firebaseImportMap = {
          imports: {
            "firebase/app": `https://www.gstatic.com/firebasejs/${FIREBASE_SDK_VERSION}/firebase-app.js`,
            "firebase/auth": `https://www.gstatic.com/firebasejs/${FIREBASE_SDK_VERSION}/firebase-auth.js`,
            "firebase/firestore": `https://www.gstatic.com/firebasejs/${FIREBASE_SDK_VERSION}/firebase-firestore.js`,
          },
        };

        // Fetch Firebase Hosting's init.json (optional but handy)
        try {
          const res = await fetch("/__/firebase/init.json", { cache: "no-store" });
          if (res.ok) {
            const json = await res.json();
            if (json && typeof json === "object") {
              window.__FIREBASE_CONFIG__ = json; // available to your firebase.js if you want it
              const hostingBase = `/__/firebase/${FIREBASE_SDK_VERSION}/`;
              firebaseImportMap.imports["firebase/app"] = `${hostingBase}firebase-app.js`;
              firebaseImportMap.imports["firebase/auth"] = `${hostingBase}firebase-auth.js`;
              firebaseImportMap.imports["firebase/firestore"] = `${hostingBase}firebase-firestore.js`;
            }
          }
        } catch (e) {
          console.warn("[firebase] init.json not available, using CDN Firebase modules", e);
        }

        const importMapEl = document.createElement("script");
        importMapEl.type = "importmap";
        importMapEl.textContent = JSON.stringify(firebaseImportMap);
        document.head.append(importMapEl);

        // Load your app exactly once
        const entryModule = document.createElement("script");
        entryModule.type = "module";
        entryModule.src = "./src/main.js";
        document.body.append(entryModule);
      })();
      const FIREBASE_SDK_VERSION = "12.4.0";
      const firebaseImportMap = {
        imports: {
          "firebase/app": `https://www.gstatic.com/firebasejs/${FIREBASE_SDK_VERSION}/firebase-app.js`,
          "firebase/auth": `https://www.gstatic.com/firebasejs/${FIREBASE_SDK_VERSION}/firebase-auth.js`,
          "firebase/firestore": `https://www.gstatic.com/firebasejs/${FIREBASE_SDK_VERSION}/firebase-firestore.js`,
        },
      };

      // Fetch Firebase Hosting's init.json (optional but handy)
      try {
        const res = await fetch("/__/firebase/init.json", { cache: "no-store" });
        if (res.ok) {
          const json = await res.json();
          if (json && typeof json === "object") {
            window.__FIREBASE_CONFIG__ = json; // available to your firebase.js if you want it
            const hostingBase = `/__/firebase/${FIREBASE_SDK_VERSION}/`;
            firebaseImportMap.imports["firebase/app"] = `${hostingBase}firebase-app.js`;
            firebaseImportMap.imports["firebase/auth"] = `${hostingBase}firebase-auth.js`;
            firebaseImportMap.imports["firebase/firestore"] = `${hostingBase}firebase-firestore.js`;
          }
        }
      } catch (e) {
        console.warn("[firebase] init.json not available, using CDN Firebase modules", e);
      }

      const importMapEl = document.createElement("script");
      importMapEl.type = "importmap";
      importMapEl.textContent = JSON.stringify(firebaseImportMap);
      document.head.append(importMapEl);

      // Load your app exactly once
      await import("./src/main.js");
    </script>
  </body>
</html>
