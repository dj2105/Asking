<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jemimaâ€™s Asking</title>

    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="/favicon.ico" />

    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js"
      }
    }
    </script>
  </head>
  <body>
    <div id="app"></div>

    <p
      id="emuBanner"
      hidden
      style="display:flex;align-items:center;justify-content:center;position:fixed;left:0;bottom:0;width:100%;margin:0;padding:4px 0;font-size:.9em;background:rgba(255,255,255,.9);border-top:1px solid #e0e0e0;z-index:1000;"
    >
      Running in emulator mode. Do not use with production credentials.
    </p>

    <script type="module">
      const qs = new URLSearchParams(window.location.search);
      const isLocal = ["localhost", "127.0.0.1"].includes(window.location.hostname) || qs.get("emu") === "1";
      const banner = document.getElementById("emuBanner");
      if (isLocal && banner) {
        banner.hidden = false;
      }

      const controller = typeof AbortController === "function" ? new AbortController() : null;
      const timeoutId = controller ? setTimeout(() => controller.abort(), 1500) : null;

      try {
        const res = await fetch("/__/firebase/init.json", {
          cache: "no-store",
          signal: controller?.signal,
        });
        if (res?.ok) {
          const json = await res.json();
          if (json && typeof json === "object") {
            window.__FIREBASE_CONFIG__ = json;
          }
        }
      } catch (err) {
        if (err?.name !== "AbortError") {
          console.warn("[firebase] init.json unavailable; using bundled config", err);
        }
      } finally {
        if (timeoutId) clearTimeout(timeoutId);
      }

      await import("/src/main.js");
    </script>
  </body>
</html>
