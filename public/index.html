<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jemima’s Asking</title>

    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="/favicon.ico" />

    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js"
      }
    }
    </script>
  </head>
  <body>
    <div class="aura-canvas" aria-hidden="true">
      <div class="aura-canvas__glow aura-canvas__glow--one"></div>
      <div class="aura-canvas__glow aura-canvas__glow--two"></div>
      <div class="aura-canvas__glow aura-canvas__glow--three"></div>
      <div class="aura-canvas__glyphs">
        <span class="aura-canvas__glyph">△</span>
        <span class="aura-canvas__glyph">✷</span>
        <span class="aura-canvas__glyph">✦</span>
        <span class="aura-canvas__glyph">✹</span>
        <span class="aura-canvas__glyph">✧</span>
      </div>
    </div>
    <div id="app"></div>

    <p
      id="emuBanner"
      hidden
      style="display:flex;align-items:center;justify-content:center;position:fixed;left:0;bottom:0;width:100%;margin:0;padding:4px 0;font-size:.9em;background:rgba(255,255,255,.9);border-top:1px solid #e0e0e0;z-index:1000;"
    >
      Running in emulator mode. Do not use with production credentials.
    </p>

<script type="importmap">
{
  "imports": {
    "firebase/app": "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js"
  }
}
</script>

<script type="module">
  // Optional: show emulator banner only on localhost or ?emu=1
  const qs = new URLSearchParams(location.search);
  const isLocal = ["localhost","127.0.0.1"].includes(location.hostname) || qs.get("emu")==="1";
  const banner = document.getElementById("emuBanner");
  if (isLocal && banner) banner.style.display = "block";

  // Try to fetch Hosting config; don't block if missing (local Python server etc.)
  async function injectFirebaseConfig() {
    const ctl = new AbortController();
    const timeout = setTimeout(() => ctl.abort(), 1500);
    try {
      const res = await fetch("/__/firebase/init.json", { cache: "no-store", signal: ctl.signal });
      if (res.ok) {
        const json = await res.json();
        if (json && typeof json === "object") window.__FIREBASE_CONFIG__ = json;
      }
    } catch (_) {} finally {
      clearTimeout(timeout);
    }
  }

  await injectFirebaseConfig();
  await import("/src/main.js");   // <— exactly one import; do NOT duplicate
</script>
  </body>
</html>
